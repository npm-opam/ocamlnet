<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Nethttpd_services.html">
<link rel="next" href="Nethttpd_util.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Uq_gtk" rel="Chapter" href="Uq_gtk.html">
<link title="Uq_tcl" rel="Chapter" href="Uq_tcl.html">
<link title="Equeue" rel="Chapter" href="Equeue.html">
<link title="Unixqueue" rel="Chapter" href="Unixqueue.html">
<link title="Unixqueue_pollset" rel="Chapter" href="Unixqueue_pollset.html">
<link title="Unixqueue_select" rel="Chapter" href="Unixqueue_select.html">
<link title="Uq_resolver" rel="Chapter" href="Uq_resolver.html">
<link title="Uq_engines" rel="Chapter" href="Uq_engines.html">
<link title="Uq_multiplex" rel="Chapter" href="Uq_multiplex.html">
<link title="Uq_transfer" rel="Chapter" href="Uq_transfer.html">
<link title="Uq_socks5" rel="Chapter" href="Uq_socks5.html">
<link title="Uq_io" rel="Chapter" href="Uq_io.html">
<link title="Uq_lwt" rel="Chapter" href="Uq_lwt.html">
<link title="Uq_libevent" rel="Chapter" href="Uq_libevent.html">
<link title="Uq_mt" rel="Chapter" href="Uq_mt.html">
<link title="Uq_client" rel="Chapter" href="Uq_client.html">
<link title="Uq_server" rel="Chapter" href="Uq_server.html">
<link title="Uq_datagram" rel="Chapter" href="Uq_datagram.html">
<link title="Uq_engines_compat" rel="Chapter" href="Uq_engines_compat.html">
<link title="Equeue_intro" rel="Chapter" href="Equeue_intro.html">
<link title="Equeue_howto" rel="Chapter" href="Equeue_howto.html">
<link title="Netcamlbox" rel="Chapter" href="Netcamlbox.html">
<link title="Netcgi_apache" rel="Chapter" href="Netcgi_apache.html">
<link title="Netcgi_modtpl" rel="Chapter" href="Netcgi_modtpl.html">
<link title="Netcgi_plex" rel="Chapter" href="Netcgi_plex.html">
<link title="Netcgi_common" rel="Chapter" href="Netcgi_common.html">
<link title="Netcgi" rel="Chapter" href="Netcgi.html">
<link title="Netcgi_ajp" rel="Chapter" href="Netcgi_ajp.html">
<link title="Netcgi_scgi" rel="Chapter" href="Netcgi_scgi.html">
<link title="Netcgi_cgi" rel="Chapter" href="Netcgi_cgi.html">
<link title="Netcgi_fcgi" rel="Chapter" href="Netcgi_fcgi.html">
<link title="Netcgi_dbi" rel="Chapter" href="Netcgi_dbi.html">
<link title="Netcgi1_compat" rel="Chapter" href="Netcgi1_compat.html">
<link title="Netcgi_test" rel="Chapter" href="Netcgi_test.html">
<link title="Netcgi_porting" rel="Chapter" href="Netcgi_porting.html">
<link title="Nethttp_client_conncache" rel="Chapter" href="Nethttp_client_conncache.html">
<link title="Nethttp_client" rel="Chapter" href="Nethttp_client.html">
<link title="Nettelnet_client" rel="Chapter" href="Nettelnet_client.html">
<link title="Netftp_data_endpoint" rel="Chapter" href="Netftp_data_endpoint.html">
<link title="Netftp_client" rel="Chapter" href="Netftp_client.html">
<link title="Nethttp_fs" rel="Chapter" href="Nethttp_fs.html">
<link title="Netftp_fs" rel="Chapter" href="Netftp_fs.html">
<link title="Netsmtp" rel="Chapter" href="Netsmtp.html">
<link title="Netpop" rel="Chapter" href="Netpop.html">
<link title="Netldap" rel="Chapter" href="Netldap.html">
<link title="Netclient_tut" rel="Chapter" href="Netclient_tut.html">
<link title="Netgss_bindings" rel="Chapter" href="Netgss_bindings.html">
<link title="Netgss" rel="Chapter" href="Netgss.html">
<link title="Nethttpd_types" rel="Chapter" href="Nethttpd_types.html">
<link title="Nethttpd_kernel" rel="Chapter" href="Nethttpd_kernel.html">
<link title="Nethttpd_reactor" rel="Chapter" href="Nethttpd_reactor.html">
<link title="Nethttpd_engine" rel="Chapter" href="Nethttpd_engine.html">
<link title="Nethttpd_services" rel="Chapter" href="Nethttpd_services.html">
<link title="Nethttpd_plex" rel="Chapter" href="Nethttpd_plex.html">
<link title="Nethttpd_util" rel="Chapter" href="Nethttpd_util.html">
<link title="Nethttpd_intro" rel="Chapter" href="Nethttpd_intro.html">
<link title="Netmcore" rel="Chapter" href="Netmcore.html">
<link title="Netmcore_camlbox" rel="Chapter" href="Netmcore_camlbox.html">
<link title="Netmcore_mempool" rel="Chapter" href="Netmcore_mempool.html">
<link title="Netmcore_heap" rel="Chapter" href="Netmcore_heap.html">
<link title="Netmcore_ref" rel="Chapter" href="Netmcore_ref.html">
<link title="Netmcore_array" rel="Chapter" href="Netmcore_array.html">
<link title="Netmcore_sem" rel="Chapter" href="Netmcore_sem.html">
<link title="Netmcore_mutex" rel="Chapter" href="Netmcore_mutex.html">
<link title="Netmcore_condition" rel="Chapter" href="Netmcore_condition.html">
<link title="Netmcore_queue" rel="Chapter" href="Netmcore_queue.html">
<link title="Netmcore_buffer" rel="Chapter" href="Netmcore_buffer.html">
<link title="Netmcore_matrix" rel="Chapter" href="Netmcore_matrix.html">
<link title="Netmcore_hashtbl" rel="Chapter" href="Netmcore_hashtbl.html">
<link title="Netmcore_process" rel="Chapter" href="Netmcore_process.html">
<link title="Netmcore_tut" rel="Chapter" href="Netmcore_tut.html">
<link title="Netmcore_basics" rel="Chapter" href="Netmcore_basics.html">
<link title="Netplex_types" rel="Chapter" href="Netplex_types.html">
<link title="Netplex_mp" rel="Chapter" href="Netplex_mp.html">
<link title="Netplex_mt" rel="Chapter" href="Netplex_mt.html">
<link title="Netplex_log" rel="Chapter" href="Netplex_log.html">
<link title="Netplex_controller" rel="Chapter" href="Netplex_controller.html">
<link title="Netplex_container" rel="Chapter" href="Netplex_container.html">
<link title="Netplex_sockserv" rel="Chapter" href="Netplex_sockserv.html">
<link title="Netplex_workload" rel="Chapter" href="Netplex_workload.html">
<link title="Netplex_main" rel="Chapter" href="Netplex_main.html">
<link title="Netplex_config" rel="Chapter" href="Netplex_config.html">
<link title="Netplex_kit" rel="Chapter" href="Netplex_kit.html">
<link title="Rpc_netplex" rel="Chapter" href="Rpc_netplex.html">
<link title="Netplex_cenv" rel="Chapter" href="Netplex_cenv.html">
<link title="Netplex_semaphore" rel="Chapter" href="Netplex_semaphore.html">
<link title="Netplex_sharedvar" rel="Chapter" href="Netplex_sharedvar.html">
<link title="Netplex_mutex" rel="Chapter" href="Netplex_mutex.html">
<link title="Netplex_encap" rel="Chapter" href="Netplex_encap.html">
<link title="Netplex_mbox" rel="Chapter" href="Netplex_mbox.html">
<link title="Netplex_internal" rel="Chapter" href="Netplex_internal.html">
<link title="Netplex_intro" rel="Chapter" href="Netplex_intro.html">
<link title="Netplex_advanced" rel="Chapter" href="Netplex_advanced.html">
<link title="Netplex_admin" rel="Chapter" href="Netplex_admin.html">
<link title="Netshm" rel="Chapter" href="Netshm.html">
<link title="Netshm_data" rel="Chapter" href="Netshm_data.html">
<link title="Netshm_hashtbl" rel="Chapter" href="Netshm_hashtbl.html">
<link title="Netshm_array" rel="Chapter" href="Netshm_array.html">
<link title="Netshm_intro" rel="Chapter" href="Netshm_intro.html">
<link title="Netstring_pcre" rel="Chapter" href="Netstring_pcre.html">
<link title="Netconversion" rel="Chapter" href="Netconversion.html">
<link title="Netchannels" rel="Chapter" href="Netchannels.html">
<link title="Netstream" rel="Chapter" href="Netstream.html">
<link title="Netmime_string" rel="Chapter" href="Netmime_string.html">
<link title="Netmime" rel="Chapter" href="Netmime.html">
<link title="Netsendmail" rel="Chapter" href="Netsendmail.html">
<link title="Neturl" rel="Chapter" href="Neturl.html">
<link title="Netaddress" rel="Chapter" href="Netaddress.html">
<link title="Netbuffer" rel="Chapter" href="Netbuffer.html">
<link title="Netmime_header" rel="Chapter" href="Netmime_header.html">
<link title="Netmime_channels" rel="Chapter" href="Netmime_channels.html">
<link title="Neturl_ldap" rel="Chapter" href="Neturl_ldap.html">
<link title="Netdate" rel="Chapter" href="Netdate.html">
<link title="Netencoding" rel="Chapter" href="Netencoding.html">
<link title="Netulex" rel="Chapter" href="Netulex.html">
<link title="Netaccel" rel="Chapter" href="Netaccel.html">
<link title="Netaccel_link" rel="Chapter" href="Netaccel_link.html">
<link title="Nethtml" rel="Chapter" href="Nethtml.html">
<link title="Netstring_str" rel="Chapter" href="Netstring_str.html">
<link title="Netmappings" rel="Chapter" href="Netmappings.html">
<link title="Netaux" rel="Chapter" href="Netaux.html">
<link title="Nethttp" rel="Chapter" href="Nethttp.html">
<link title="Netpagebuffer" rel="Chapter" href="Netpagebuffer.html">
<link title="Netfs" rel="Chapter" href="Netfs.html">
<link title="Netglob" rel="Chapter" href="Netglob.html">
<link title="Netauth" rel="Chapter" href="Netauth.html">
<link title="Netsockaddr" rel="Chapter" href="Netsockaddr.html">
<link title="Netnumber" rel="Chapter" href="Netnumber.html">
<link title="Netxdr_mstring" rel="Chapter" href="Netxdr_mstring.html">
<link title="Netxdr" rel="Chapter" href="Netxdr.html">
<link title="Netcompression" rel="Chapter" href="Netcompression.html">
<link title="Netunichar" rel="Chapter" href="Netunichar.html">
<link title="Netasn1" rel="Chapter" href="Netasn1.html">
<link title="Netasn1_encode" rel="Chapter" href="Netasn1_encode.html">
<link title="Netoid" rel="Chapter" href="Netoid.html">
<link title="Netstring_tstring" rel="Chapter" href="Netstring_tstring.html">
<link title="Netdn" rel="Chapter" href="Netdn.html">
<link title="Netx509" rel="Chapter" href="Netx509.html">
<link title="Netascii_armor" rel="Chapter" href="Netascii_armor.html">
<link title="Nettls_support" rel="Chapter" href="Nettls_support.html">
<link title="Netmech_scram" rel="Chapter" href="Netmech_scram.html">
<link title="Netmech_scram_gssapi" rel="Chapter" href="Netmech_scram_gssapi.html">
<link title="Netmech_scram_sasl" rel="Chapter" href="Netmech_scram_sasl.html">
<link title="Netmech_scram_http" rel="Chapter" href="Netmech_scram_http.html">
<link title="Netgssapi_support" rel="Chapter" href="Netgssapi_support.html">
<link title="Netgssapi_auth" rel="Chapter" href="Netgssapi_auth.html">
<link title="Netchannels_crypto" rel="Chapter" href="Netchannels_crypto.html">
<link title="Netx509_pubkey" rel="Chapter" href="Netx509_pubkey.html">
<link title="Netx509_pubkey_crypto" rel="Chapter" href="Netx509_pubkey_crypto.html">
<link title="Netsaslprep" rel="Chapter" href="Netsaslprep.html">
<link title="Netmech_plain_sasl" rel="Chapter" href="Netmech_plain_sasl.html">
<link title="Netmech_crammd5_sasl" rel="Chapter" href="Netmech_crammd5_sasl.html">
<link title="Netmech_digest_sasl" rel="Chapter" href="Netmech_digest_sasl.html">
<link title="Netmech_digest_http" rel="Chapter" href="Netmech_digest_http.html">
<link title="Netmech_krb5_sasl" rel="Chapter" href="Netmech_krb5_sasl.html">
<link title="Netmech_gs2_sasl" rel="Chapter" href="Netmech_gs2_sasl.html">
<link title="Netmech_spnego_http" rel="Chapter" href="Netmech_spnego_http.html">
<link title="Netchannels_tut" rel="Chapter" href="Netchannels_tut.html">
<link title="Netmime_tut" rel="Chapter" href="Netmime_tut.html">
<link title="Netsendmail_tut" rel="Chapter" href="Netsendmail_tut.html">
<link title="Netulex_tut" rel="Chapter" href="Netulex_tut.html">
<link title="Neturl_tut" rel="Chapter" href="Neturl_tut.html">
<link title="Netsys" rel="Chapter" href="Netsys.html">
<link title="Netsys_posix" rel="Chapter" href="Netsys_posix.html">
<link title="Netsys_pollset" rel="Chapter" href="Netsys_pollset.html">
<link title="Netlog" rel="Chapter" href="Netlog.html">
<link title="Netexn" rel="Chapter" href="Netexn.html">
<link title="Netsys_win32" rel="Chapter" href="Netsys_win32.html">
<link title="Netsys_pollset_posix" rel="Chapter" href="Netsys_pollset_posix.html">
<link title="Netsys_pollset_win32" rel="Chapter" href="Netsys_pollset_win32.html">
<link title="Netsys_pollset_generic" rel="Chapter" href="Netsys_pollset_generic.html">
<link title="Netsys_signal" rel="Chapter" href="Netsys_signal.html">
<link title="Netsys_oothr" rel="Chapter" href="Netsys_oothr.html">
<link title="Netsys_xdr" rel="Chapter" href="Netsys_xdr.html">
<link title="Netsys_rng" rel="Chapter" href="Netsys_rng.html">
<link title="Netsys_crypto_types" rel="Chapter" href="Netsys_crypto_types.html">
<link title="Netsys_types" rel="Chapter" href="Netsys_types.html">
<link title="Netsys_mem" rel="Chapter" href="Netsys_mem.html">
<link title="Netsys_tmp" rel="Chapter" href="Netsys_tmp.html">
<link title="Netsys_sem" rel="Chapter" href="Netsys_sem.html">
<link title="Netsys_pmanage" rel="Chapter" href="Netsys_pmanage.html">
<link title="Netsys_crypto" rel="Chapter" href="Netsys_crypto.html">
<link title="Netsys_tls" rel="Chapter" href="Netsys_tls.html">
<link title="Netsys_ciphers" rel="Chapter" href="Netsys_ciphers.html">
<link title="Netsys_digests" rel="Chapter" href="Netsys_digests.html">
<link title="Netsys_crypto_modes" rel="Chapter" href="Netsys_crypto_modes.html">
<link title="Netsys_gssapi" rel="Chapter" href="Netsys_gssapi.html">
<link title="Netsys_sasl_types" rel="Chapter" href="Netsys_sasl_types.html">
<link title="Netsys_sasl" rel="Chapter" href="Netsys_sasl.html">
<link title="Netsys_polypipe" rel="Chapter" href="Netsys_polypipe.html">
<link title="Netsys_polysocket" rel="Chapter" href="Netsys_polysocket.html">
<link title="Netsys_global" rel="Chapter" href="Netsys_global.html">
<link title="Nettls_gnutls_bindings" rel="Chapter" href="Nettls_gnutls_bindings.html">
<link title="Nettls_nettle_bindings" rel="Chapter" href="Nettls_nettle_bindings.html">
<link title="Nettls_gnutls" rel="Chapter" href="Nettls_gnutls.html">
<link title="Netunidata" rel="Chapter" href="Netunidata.html">
<link title="Netgzip" rel="Chapter" href="Netgzip.html">
<link title="Rpc_auth_local" rel="Chapter" href="Rpc_auth_local.html">
<link title="Rpc_xti_client" rel="Chapter" href="Rpc_xti_client.html">
<link title="Rpc" rel="Chapter" href="Rpc.html">
<link title="Rpc_program" rel="Chapter" href="Rpc_program.html">
<link title="Rpc_util" rel="Chapter" href="Rpc_util.html">
<link title="Rpc_portmapper_aux" rel="Chapter" href="Rpc_portmapper_aux.html">
<link title="Rpc_packer" rel="Chapter" href="Rpc_packer.html">
<link title="Rpc_transport" rel="Chapter" href="Rpc_transport.html">
<link title="Rpc_client" rel="Chapter" href="Rpc_client.html">
<link title="Rpc_simple_client" rel="Chapter" href="Rpc_simple_client.html">
<link title="Rpc_portmapper_clnt" rel="Chapter" href="Rpc_portmapper_clnt.html">
<link title="Rpc_portmapper" rel="Chapter" href="Rpc_portmapper.html">
<link title="Rpc_server" rel="Chapter" href="Rpc_server.html">
<link title="Rpc_auth_sys" rel="Chapter" href="Rpc_auth_sys.html">
<link title="Rpc_auth_gssapi" rel="Chapter" href="Rpc_auth_gssapi.html">
<link title="Rpc_proxy" rel="Chapter" href="Rpc_proxy.html">
<link title="Rpc_intro" rel="Chapter" href="Rpc_intro.html">
<link title="Rpc_mapping_ref" rel="Chapter" href="Rpc_mapping_ref.html">
<link title="Rpc_intro_gss" rel="Chapter" href="Rpc_intro_gss.html">
<link title="Shell_sys" rel="Chapter" href="Shell_sys.html">
<link title="Shell" rel="Chapter" href="Shell.html">
<link title="Shell_uq" rel="Chapter" href="Shell_uq.html">
<link title="Shell_fs" rel="Chapter" href="Shell_fs.html">
<link title="Shell_intro" rel="Chapter" href="Shell_intro.html">
<link title="Intro" rel="Chapter" href="Intro.html">
<link title="Platform" rel="Chapter" href="Platform.html">
<link title="Foreword" rel="Chapter" href="Foreword.html">
<link title="Ipv6" rel="Chapter" href="Ipv6.html">
<link title="Regexp" rel="Chapter" href="Regexp.html">
<link title="Tls" rel="Chapter" href="Tls.html">
<link title="Crypto" rel="Chapter" href="Crypto.html">
<link title="Authentication" rel="Chapter" href="Authentication.html">
<link title="Credentials" rel="Chapter" href="Credentials.html">
<link title="Gssapi" rel="Chapter" href="Gssapi.html">
<link title="Ocamlnet4" rel="Chapter" href="Ocamlnet4.html">
<link title="Get" rel="Chapter" href="Get.html"><link title="Configuration files" rel="Section" href="#2_Configurationfiles">
<link title="Configuration files" rel="Section" href="#2_Configurationfiles">
<link title="Configuring TLS" rel="Section" href="#tls">
<title>Ocamlnet 4 Reference Manual : Nethttpd_plex</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Nethttpd_services.html" title="Nethttpd_services">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Nethttpd_util.html" title="Nethttpd_util">Next</a>
</div>
<h1>Module <a href="type_Nethttpd_plex.html">Nethttpd_plex</a></h1>

<pre><span class="keyword">module</span> Nethttpd_plex: <code class="code">sig</code> <a href="Nethttpd_plex.html">..</a> <code class="code">end</code></pre><div class="info module top">
<h1 id="1_Netplexsupport">Netplex support</h1><br>
</div>
<hr width="100%">
<br>
The important function is <code class="code">nethttpd_factory</code>, see below. The
    other functions are only needed for special effects.
<p>

    An example is explained here: <a href="Netplex_intro.html#webserver"><i>Example - A Simple Web Server</i></a><br>

<pre><span id="TYPEconfig_log_error"><span class="keyword">type</span> <code class="type"></code>config_log_error</span> = <code class="type"><a href="Nethttpd_types.request_info-c.html">Nethttpd_types.request_info</a> -> string -> unit</code> </pre>


<pre><span id="TYPEconfig_log_access"><span class="keyword">type</span> <code class="type"></code>config_log_access</span> = <code class="type"><a href="Nethttpd_types.full_info-c.html">Nethttpd_types.full_info</a> -> unit</code> </pre>


<pre><span id="TYPEconfig_error_response"><span class="keyword">type</span> <code class="type"></code>config_error_response</span> = <code class="type"><a href="Nethttpd_types.error_response_params-c.html">Nethttpd_types.error_response_params</a> -> string</code> </pre>
<div class="info ">
Three type abbreviations for logging functions<br>
</div>


<pre><span id="VALstd_log_error"><span class="keyword">val</span> std_log_error</span> : <code class="type"><a href="Netplex_types.container-c.html">Netplex_types.container</a> -> <a href="Nethttpd_plex.html#TYPEconfig_log_error">config_log_error</a></code></pre><div class="info ">
Returns a function that logs errors using the <code class="code">log_subch</code> method of
      the passed container<br>
</div>

<pre><span id="VALstd_log_access"><span class="keyword">val</span> std_log_access</span> : <code class="type">?debug:bool -> <a href="Netplex_types.container-c.html">Netplex_types.container</a> -> <a href="Nethttpd_plex.html#TYPEconfig_log_access">config_log_access</a></code></pre><div class="info ">
Returns a function that logs accesses using the <code class="code">log_subch</code> method of
      the passed container
<p>

      If <code class="code">debug</code> is set, additional debug log messages are printed that
      dump the whole access (incl. header and all available information)<br>
</div>

<pre><span id="VALstd_error_response"><span class="keyword">val</span> std_error_response</span> : <code class="type"><a href="Nethttpd_plex.html#TYPEconfig_error_response">config_error_response</a></code></pre><div class="info ">
A sample error response function<br>
</div>

<pre><span id="VALrestrict_file_service_config"><span class="keyword">val</span> restrict_file_service_config</span> : <code class="type"><a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -> <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -> unit</code></pre><div class="info ">
Restricts the subsections and paremeters in the <code class="code">service</code>
      configuration section of type "file" to the allowed ones.<br>
</div>

<pre><span id="VALread_file_service_config"><span class="keyword">val</span> read_file_service_config</span> : <code class="type"><a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -><br>       <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -> string -> <a href="Nethttpd_services.html#TYPEfile_service">Nethttpd_services.file_service</a></code></pre><div class="info ">
<code class="code">read_file_service_config cfg addr uri_path</code>: Reads the
      <code class="code">service</code> configuration section of type "file" from config file
      <code class="code">cfg</code> at address <code class="code">addr</code>.  <code class="code">uri_path</code> is the default value put
      into the <code class="code">file_uri</code> component of the returned record if no "uri"
      configuration parameter exists. (In other words, this is the
      path of the enclosing "uri" section, or "/" if there is only
      a "host" section.) All other parameters are only
      taken from the configuration section. 
<p>

      See below at <code class="code">nethttpd_factory</code> how a file service needs to
      be configured.<br>
</div>

<pre><span id="VALrestrict_dynamic_service_config"><span class="keyword">val</span> restrict_dynamic_service_config</span> : <code class="type"><a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -> <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -> unit</code></pre><div class="info ">
Restricts the subsections and paremeters in the <code class="code">service</code>
      configuration section of type "dynamic" to the allowed ones.<br>
</div>

<pre><span id="VALread_dynamic_service_config"><span class="keyword">val</span> read_dynamic_service_config</span> : <code class="type">(string *<br>        (<a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -><br>         <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -><br>         string -> (#<a href="Netcgi.cgi_activation-c.html">Netcgi.cgi_activation</a> as 'a) <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a>))<br>       list -><br>       <a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -><br>       <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -> string -> 'a <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a></code></pre><div class="info ">
<code class="code">read_dynamic_service_config handlers cfg addr uri_path</code>:
      Reads the <code class="code">service</code> configuration section of type "dynamic" from config 
      file <code class="code">cfg</code> at address <code class="code">addr</code>. The alist <code class="code">handlers</code> defines the
      available handlers. Every handler <code class="code">h</code> is called like
      <code class="code">h cfg addr uri_path</code>. <code class="code">uri_path</code> is like in <code class="code">read_file_service_config</code>,
      i.e. the path of the enclosing "uri" section, or "/" by default.
<p>

      The <code class="code">h</code> function has to return the dynamic service to use, which
      is also returned by <code class="code">read_dynamic_service_config</code>.
<p>

      See below at <code class="code">nethttpd_factory</code> how a dynamic service needs to
      be configured.<br>
</div>

<pre><span id="TYPEencap"><span class="keyword">type</span> <code class="type"></code>encap</span> = <code class="type">[ `Engine | `Reactor ]</code> </pre>


<pre><span id="VALnethttpd_processor"><span class="keyword">val</span> nethttpd_processor</span> : <code class="type">?hooks:<a href="Netplex_types.processor_hooks-c.html">Netplex_types.processor_hooks</a> -><br>       ?encap:<a href="Nethttpd_plex.html#TYPEencap">encap</a> -><br>       (<a href="Netplex_types.container-c.html">Netplex_types.container</a> -> #<a href="Nethttpd_reactor.http_reactor_config-c.html">Nethttpd_reactor.http_reactor_config</a>) -><br>       'a <a href="Nethttpd_types.http_service-c.html">Nethttpd_types.http_service</a> -> <a href="Netplex_types.processor-c.html">Netplex_types.processor</a></code></pre><div class="info ">
<code class="code">netplex_processor mk_config http_service</code>: Creates a Netplex processor
 for Nethttpd.
<p>

 <code class="code">mk_config</code> determines the nethttpd config for a container.
 This is especially useful for setting the logging functions.
<p>

 The resulting processor must be turned into a full Netplex service
 by <code class="code">Netplex_sockserv.create_socket_service</code> which can then be added
 by calling the controller's method <code class="code">add_service</code>.
<p>

 <code class="code">hooks</code>: One can pass a Netplex hook object to set the hooks of the
 processor.
<p>

 <code class="code">encap</code>: Selects the encapsulation, <code class="code">`Reactor</code> or <code class="code">`Engine</code>. 
 The default is <code class="code">`Reactor</code>. Each encapsulation has specific strengths
 and weaknesses:<ul>
<li><code class="code">`Reactor</code> is simpler code. Also, the request and response bodies
   need not to be buffered up, and are directly connected with the 
   underlying socket (low memory requirement). The disadvantage is
   that a reactor processes TCP connections serially (important to know
   when there is only a single Unix process)</li>
<li><code class="code">`Engine</code>: The request body needs to be completely buffered up.
   If pipelining is enabled, the response bodies are also buffered
   (FIXME).
   The advantage of this encapsulation is that the engine can
   process multiple TCP connections simultaneously, even in a 
   single process/thread.</li>
</ul>
<br>
</div>

<pre><span id="TYPEservice_factory"><span class="keyword">type</span> <code class="type">(#<a href="Netcgi.cgi_activation-c.html">Netcgi.cgi_activation</a><br>       , [ `Dynamic_service of<br>             (#<a href="Netcgi.cgi_activation-c.html">Netcgi.cgi_activation</a> as 'a) <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a><br>         | `File_service of <a href="Nethttpd_services.html#TYPEfile_service">Nethttpd_services.file_service</a> ])</code> service_factory</span> = <code class="type">(string * 'a <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a>) list -><br>       <a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -><br>       <a href="Netplex_types.html#TYPEaddress">Netplex_types.address</a> -><br>       string -><br>       [ `Dynamic_service of 'a <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a><br>       | `File_service of <a href="Nethttpd_services.html#TYPEfile_service">Nethttpd_services.file_service</a> ]<br>       <a href="Nethttpd_types.http_service-c.html">Nethttpd_types.http_service</a></code> </pre>
<div class="info ">
The service factory function is called when a <code class="code">service</code> configuration
      section of a certain type needs to be read. The function has args
      <code class="code">handlers</code>, <code class="code">cfg</code>, <code class="code">addr</code>, and <code class="code">uri_path</code>. It needs to return the
      <code class="code">http_service</code>.
<p>

      Such a function is usually <code class="code">read_file_service_config</code>, or
      <code class="code">read_dynamic_service_config</code>, or a derivative, whose return
      value is turned into a <code class="code">http_service</code>. This can be done with
      <a href="Nethttpd_services.html#VALfile_service"><code class="code">Nethttpd_services.file_service</code></a> and
      <a href="Nethttpd_services.html#VALdynamic_service"><code class="code">Nethttpd_services.dynamic_service</code></a>.<br>
</div>


<pre><span id="VALdefault_services"><span class="keyword">val</span> default_services</span> : <code class="type">(string *<br>        (#<a href="Netcgi.cgi_activation-c.html">Netcgi.cgi_activation</a> as 'a,<br>         [ `Dynamic_service of 'a <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a><br>         | `File_service of <a href="Nethttpd_services.html#TYPEfile_service">Nethttpd_services.file_service</a> ])<br>        <a href="Nethttpd_plex.html#TYPEservice_factory">service_factory</a>)<br>       list</code></pre><div class="info ">
The default services<br>
</div>

<pre><code><span id="TYPEhttpd_factory"><span class="keyword">type</span> <code class="type"></code>httpd_factory</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELThttpd_factory.httpd_factory">httpd_factory</span>&nbsp;: <code class="type">'a.<br>         (<a href="Netplex_types.container-c.html">Netplex_types.container</a> -> <a href="Nethttpd_reactor.http_reactor_config-c.html">Nethttpd_reactor.http_reactor_config</a>) -><br>         'a <a href="Nethttpd_types.http_service-c.html">Nethttpd_types.http_service</a> -> <a href="Netplex_types.processor-c.html">Netplex_types.processor</a></code>;</code></td>

</tr></table>
}

<div class="info ">
The type of the <code class="code">nethttpd_processor</code> function<br>
</div>


<pre><span id="VALnethttpd_factory"><span class="keyword">val</span> nethttpd_factory</span> : <code class="type">?name:string -><br>       ?hooks:<a href="Netplex_types.processor_hooks-c.html">Netplex_types.processor_hooks</a> -><br>       ?encap:<a href="Nethttpd_plex.html#TYPEencap">encap</a> -><br>       ?config_cgi:<a href="Netcgi.html#TYPEconfig">Netcgi.config</a> -><br>       ?handlers:(string *<br>                  (#<a href="Netcgi.cgi_activation-c.html">Netcgi.cgi_activation</a> as 'a) <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a>)<br>                 list -><br>       ?services:(string *<br>                  ('a,<br>                   [ `Dynamic_service of 'a <a href="Nethttpd_services.html#TYPEdynamic_service">Nethttpd_services.dynamic_service</a><br>                   | `File_service of <a href="Nethttpd_services.html#TYPEfile_service">Nethttpd_services.file_service</a> ])<br>                  <a href="Nethttpd_plex.html#TYPEservice_factory">service_factory</a>)<br>                 list -><br>       ?log_error:(<a href="Netplex_types.container-c.html">Netplex_types.container</a> -> <a href="Nethttpd_plex.html#TYPEconfig_log_error">config_log_error</a>) -><br>       ?log_access:(?debug:bool -><br>                    <a href="Netplex_types.container-c.html">Netplex_types.container</a> -> <a href="Nethttpd_plex.html#TYPEconfig_log_access">config_log_access</a>) -><br>       ?error_response:<a href="Nethttpd_plex.html#TYPEconfig_error_response">config_error_response</a> -><br>       ?processor_factory:<a href="Nethttpd_plex.html#TYPEhttpd_factory">httpd_factory</a> -><br>       ?tls:(module Netsys_crypto_types.TLS_PROVIDER) -><br>       unit -> <a href="Netplex_types.processor_factory-c.html">Netplex_types.processor_factory</a></code></pre><div class="info ">
Factory for a web server component.
<p>

 <b>Configuration file.</b> See below.
<p>

 The <code class="code">services</code> optional argument can be used to change the service
 types understood. If not passed, it defaults to <code class="code">default_services</code>.
 The default includes "file" and "dynamic".
<p>

 <b>Arguments.</b>
<p>
<ul>
<li><code class="code">name</code>: The processor name. Defaults to "nethttpd". This name can
   be referenced by the "type" parameters in the <code class="code">processor</code> section
   of the config file.</li>
<li><code class="code">hooks</code>: One can pass a Netplex hook object to set the hooks of the
   processor. (This argument is ignored if a <code class="code">processor_factory</code> is
   passed to this function.)</li>
<li><code class="code">encap</code>: See <a href="Nethttpd_plex.html#VALnethttpd_processor"><code class="code">Nethttpd_plex.nethttpd_processor</code></a>. (This argument is
   ignored if a <code class="code">processor_factory</code> is
   passed to this function.)</li>
<li><code class="code">config_cgi</code>: The CGI configuration to use</li>
<li><code class="code">handlers</code>: a list of handler function. These functions can be
   referenced from a <code class="code">service</code> section in the config file where
   <code class="code">type="dynamic"</code> (see example above). Defaults to the empty list.</li>
<li><code class="code">services</code>: A list of service handlers that can be used 
   by <code class="code">service</code> sections in the config files. Defaults to
   <a href="Nethttpd_plex.html#VALdefault_services"><code class="code">Nethttpd_plex.default_services</code></a> which defines "file" and "dynamic".</li>
<li><code class="code">log_error</code>: The error logger. Defaults to
   <a href="Nethttpd_plex.html#VALstd_log_error"><code class="code">Nethttpd_plex.std_log_error</code></a>.</li>
<li><code class="code">log_access</code>: The access logger. Defaults to
   <a href="Nethttpd_plex.html#VALstd_log_access"><code class="code">Nethttpd_plex.std_log_access</code></a>.</li>
<li><code class="code">error_response</code>: a handler which is invoked to generate error
   responses. Defaults to <a href="Nethttpd_plex.html#VALstd_error_response"><code class="code">Nethttpd_plex.std_error_response</code></a>.</li>
<li><code class="code">processor_factory</code>: the function creating the processor.
   Default is <code class="code">nethttpd_processor</code>.</li>
<li><code class="code">tls</code>: the TLS provider to use. By default, 
   <a href="Netsys_crypto.html#VALcurrent_tls_opt"><code class="code">Netsys_crypto.current_tls_opt</code></a> is used.</li>
</ul>
<br>
</div>
<br>
<h2 id="2_Configurationfiles">Configuration files</h2>
<p>

The configuration file understood by <code class="code">nethttpd_factory</code> looks like:
<p>

 <pre class="codepre"><code class="code">    processor {
      type = "nethttpd";          (* or what is passed as "name" arg *)
      timeout = 300.0;
      timeout_next_request = 15.0;
      access_log = "enabled";
      suppress_broken_pipe = true;
      host {
        pref_name = "myhost";     (* optional *)
        pref_port = 80;           (* optional *)
        names = "myhost:80 yourhost:81";  (* use *:0 for any name *)
        uri {
          path = "/the/path";
          method {
            allow = "GET POST";
            (* or: deny = "..." *)
            service {
              type = "...";
              ...
            }
          }
        }
        uri {
          ...
        }
      }
      host {
        ...
      }
    }
 </code></pre>
<p>

 The <code class="code">access_log</code> parameter can be set to <code class="code">off</code>, <code class="code">enabled</code>, or <code class="code">debug</code>.
 The default is <code class="code">off</code>. Access messages go to the "access" subchannel
 of the component logger. If <code class="code">enabled</code>, one line is printed with the
 most important data. If <code class="code">debug</code> is set, all access data are printed.
<p>

 If <code class="code">suppress_broken_pipe</code> the error "Broken pipe" is not logged
 in the error log. This error occurs frequently, and may be regarded
 as a normal condition.
<p>

 The sections <code class="code">host</code>, <code class="code">uri</code> and <code class="code">method</code> can be nested to any depth.
 However, on every nesting level only one of these section types must be
 used. For example, if a <code class="code">host</code> section already contains <code class="code">uri</code>
 subsections, it is not allowed to add <code class="code">method</code> subsections.
 Furthermore, the outermost section must be <code class="code">host</code>.
<p>

 The <code class="code">service</code> section may be one of (at least if the <code class="code">services</code>
 parameter is not overridden):
<p>

 <pre class="codepre"><code class="code">    service {
      type = "file";
      docroot = "/a/path/in/the/filesystem";
      uri = "/the/uri/prefix/corresponding/to/docroot";
      media_types_file = "/etc/mime.types";
      media_type {
        type = "application/foo";
        suffix = "foo"
      }
      default_media_type = "text/plain";
      enable_gzip = true;   (* see doc in nethttpd_services.mli *)
      index_files = "index.html";
      enable_listings = true;
      hide_from_listings = "README";   (* list of PCRE regexps *)
    }
 </code></pre>
<p>

 Note that <code class="code">uri</code> is taken from the surrounding <code class="code">uri</code> section (or
 assumed to be "/" if there is none) if omitted.
<p>

 <pre class="codepre"><code class="code">    service {
      type = "dynamic";
      handler = "name_of_handler";
    }
 </code></pre>
<p>

 Binds the passed handler here.
<p>

 Any of <code class="code">host</code>, <code class="code">uri</code>, and <code class="code">method</code> sections may contain one or several
 <code class="code">access</code> sections (which are AND-connected):
<p>

 <pre class="codepre"><code class="code">    access {
      type = "host";
      allow = "host1 host2 ...";
      (* or deny = "host1 host2 ..."; *)
    }
 </code></pre>
<p>

 Other access control methods are not yet available.<br>
<br>
<h2 id="2_Configurationfiles">Configuration files</h2>
<p>

The configuration file understood by <code class="code">nethttpd_factory</code> looks like:
<p>

 <pre class="codepre"><code class="code">    processor {
      type = "nethttpd";          (* or what is passed as "name" arg *)
      timeout = 300.0;
      timeout_next_request = 15.0;
      access_log = "enabled";
      suppress_broken_pipe = true;
      host {
        pref_name = "myhost";     (* optional *)
        pref_port = 80;           (* optional *)
        names = "myhost:80 yourhost:81";  (* use *:0 for any name *)
        uri {
          path = "/the/path";
          method {
            allow = "GET POST";
            (* or: deny = "..." *)
            service {
              type = "...";
              ...
            }
          }
        }
        uri {
          ...
        }
      }
      host {
        ...
      }
    }
 </code></pre>
<p>

 The <code class="code">access_log</code> parameter can be set to <code class="code">off</code>, <code class="code">enabled</code>, or <code class="code">debug</code>.
 The default is <code class="code">off</code>. Access messages go to the "access" subchannel
 of the component logger. If <code class="code">enabled</code>, one line is printed with the
 most important data. If <code class="code">debug</code> is set, all access data are printed.
<p>

 If <code class="code">suppress_broken_pipe</code> the error "Broken pipe" is not logged
 in the error log. This error occurs frequently, and may be regarded
 as a normal condition.
<p>

 The sections <code class="code">host</code>, <code class="code">uri</code> and <code class="code">method</code> can be nested to any depth.
 However, on every nesting level only one of these section types must be
 used. For example, if a <code class="code">host</code> section already contains <code class="code">uri</code>
 subsections, it is not allowed to add <code class="code">method</code> subsections.
 Furthermore, the outermost section must be <code class="code">host</code>.
<p>

 The <code class="code">service</code> section may be one of (at least if the <code class="code">services</code>
 parameter is not overridden):
<p>

 <pre class="codepre"><code class="code">    service {
      type = "file";
      docroot = "/a/path/in/the/filesystem";
      uri = "/the/uri/prefix/corresponding/to/docroot";
      media_types_file = "/etc/mime.types";
      media_type {
        type = "application/foo";
        suffix = "foo"
      }
      default_media_type = "text/plain";
      enable_gzip = true;   (* see doc in nethttpd_services.mli *)
      index_files = "index.html";
      enable_listings = true;
      hide_from_listings = "README";   (* list of PCRE regexps *)
    }
 </code></pre>
<p>

 Note that <code class="code">uri</code> is taken from the surrounding <code class="code">uri</code> section (or
 assumed to be "/" if there is none) if omitted.
<p>

 <pre class="codepre"><code class="code">    service {
      type = "dynamic";
      handler = "name_of_handler";
    }
 </code></pre>
<p>

 Binds the passed handler here.
<p>

 Any of <code class="code">host</code>, <code class="code">uri</code>, and <code class="code">method</code> sections may contain one or several
 <code class="code">access</code> sections (which are AND-connected):
<p>

 <pre class="codepre"><code class="code">    access {
      type = "host";
      allow = "host1 host2 ...";
      (* or deny = "host1 host2 ..."; *)
    }
 </code></pre>
<p>

 Other access control methods are not yet available.<br>
<br>
<h2 id="tls">Configuring TLS</h2>
<p>

First of all, there needs to be a TLS provider. See <a href="Tls.html"><code class="code">Tls</code></a> for more information
how to get one.
<p>

If the TLS provider is initialized, you can have a <code class="code">tls</code> subsection inside
<code class="code">processor</code>, like:
<p>

<pre class="codepre"><code class="code">processor {
  ...
  tls {
    x509 {
      trust {
        crt_file = "ca.pem";
      }
      key {
        crt_file = "server.crt";
        key_file = "server.key";
      }
    }
  }
}
</code></pre>
<p>

All of the files, <code class="code">ca.pem</code>, <code class="code">server.crt</code> and <code class="code">server.key</code> need to be 
PEM-encoded. You can have several <code class="code">key</code> sub-sections when you want to do
name-based virtual hosting. Note, however, that this relies on the SNI
extension of the TLS protocol, and not all clients support this extension.
<p>

Further parameters inside <code class="code">tls</code>:
<p>
<ul>
<li><code class="code">algorithms</code>: This is a string describing the cipher suites and protocol
   options that are in effect. This string is provider-specific. (GnuTLS
   calls this string the "priority string".) Example:
   <pre class="codepre"><code class="code">tls {
   ...
   algorithms = "SECURE-128 !ARCFOUR-128";
}
   </code></pre></li>
<li><code class="code">dh_params</code>: This sub-section may set DH parameters. Example:
   <pre class="codepre"><code class="code">tls {
  ...
  dh_params {
    pkcs3_file = "/path/to/pkcs3_file";
  }
}
   </code></pre></li>
<li><code class="code">peer_auth</code>: This string parameter may enable client certificates.
   Set it to "required" to enforce such a certificate.
   <pre class="codepre"><code class="code">tls {
  ...
  peer_auth = "required";
}
   </code></pre></li>
</ul>
<br>
</body></html>