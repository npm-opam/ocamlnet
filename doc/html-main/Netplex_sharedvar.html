<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Netplex_semaphore.html">
<link rel="next" href="Netplex_mutex.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Uq_gtk" rel="Chapter" href="Uq_gtk.html">
<link title="Uq_tcl" rel="Chapter" href="Uq_tcl.html">
<link title="Equeue" rel="Chapter" href="Equeue.html">
<link title="Unixqueue" rel="Chapter" href="Unixqueue.html">
<link title="Unixqueue_pollset" rel="Chapter" href="Unixqueue_pollset.html">
<link title="Unixqueue_select" rel="Chapter" href="Unixqueue_select.html">
<link title="Uq_resolver" rel="Chapter" href="Uq_resolver.html">
<link title="Uq_engines" rel="Chapter" href="Uq_engines.html">
<link title="Uq_multiplex" rel="Chapter" href="Uq_multiplex.html">
<link title="Uq_transfer" rel="Chapter" href="Uq_transfer.html">
<link title="Uq_socks5" rel="Chapter" href="Uq_socks5.html">
<link title="Uq_io" rel="Chapter" href="Uq_io.html">
<link title="Uq_lwt" rel="Chapter" href="Uq_lwt.html">
<link title="Uq_libevent" rel="Chapter" href="Uq_libevent.html">
<link title="Uq_mt" rel="Chapter" href="Uq_mt.html">
<link title="Uq_client" rel="Chapter" href="Uq_client.html">
<link title="Uq_server" rel="Chapter" href="Uq_server.html">
<link title="Uq_datagram" rel="Chapter" href="Uq_datagram.html">
<link title="Uq_engines_compat" rel="Chapter" href="Uq_engines_compat.html">
<link title="Equeue_intro" rel="Chapter" href="Equeue_intro.html">
<link title="Equeue_howto" rel="Chapter" href="Equeue_howto.html">
<link title="Netcamlbox" rel="Chapter" href="Netcamlbox.html">
<link title="Netcgi_apache" rel="Chapter" href="Netcgi_apache.html">
<link title="Netcgi_modtpl" rel="Chapter" href="Netcgi_modtpl.html">
<link title="Netcgi_plex" rel="Chapter" href="Netcgi_plex.html">
<link title="Netcgi_common" rel="Chapter" href="Netcgi_common.html">
<link title="Netcgi" rel="Chapter" href="Netcgi.html">
<link title="Netcgi_ajp" rel="Chapter" href="Netcgi_ajp.html">
<link title="Netcgi_scgi" rel="Chapter" href="Netcgi_scgi.html">
<link title="Netcgi_cgi" rel="Chapter" href="Netcgi_cgi.html">
<link title="Netcgi_fcgi" rel="Chapter" href="Netcgi_fcgi.html">
<link title="Netcgi_dbi" rel="Chapter" href="Netcgi_dbi.html">
<link title="Netcgi1_compat" rel="Chapter" href="Netcgi1_compat.html">
<link title="Netcgi_test" rel="Chapter" href="Netcgi_test.html">
<link title="Netcgi_porting" rel="Chapter" href="Netcgi_porting.html">
<link title="Nethttp_client_conncache" rel="Chapter" href="Nethttp_client_conncache.html">
<link title="Nethttp_client" rel="Chapter" href="Nethttp_client.html">
<link title="Nettelnet_client" rel="Chapter" href="Nettelnet_client.html">
<link title="Netftp_data_endpoint" rel="Chapter" href="Netftp_data_endpoint.html">
<link title="Netftp_client" rel="Chapter" href="Netftp_client.html">
<link title="Nethttp_fs" rel="Chapter" href="Nethttp_fs.html">
<link title="Netftp_fs" rel="Chapter" href="Netftp_fs.html">
<link title="Netsmtp" rel="Chapter" href="Netsmtp.html">
<link title="Netpop" rel="Chapter" href="Netpop.html">
<link title="Netldap" rel="Chapter" href="Netldap.html">
<link title="Netclient_tut" rel="Chapter" href="Netclient_tut.html">
<link title="Netgss_bindings" rel="Chapter" href="Netgss_bindings.html">
<link title="Netgss" rel="Chapter" href="Netgss.html">
<link title="Nethttpd_types" rel="Chapter" href="Nethttpd_types.html">
<link title="Nethttpd_kernel" rel="Chapter" href="Nethttpd_kernel.html">
<link title="Nethttpd_reactor" rel="Chapter" href="Nethttpd_reactor.html">
<link title="Nethttpd_engine" rel="Chapter" href="Nethttpd_engine.html">
<link title="Nethttpd_services" rel="Chapter" href="Nethttpd_services.html">
<link title="Nethttpd_plex" rel="Chapter" href="Nethttpd_plex.html">
<link title="Nethttpd_util" rel="Chapter" href="Nethttpd_util.html">
<link title="Nethttpd_intro" rel="Chapter" href="Nethttpd_intro.html">
<link title="Netmcore" rel="Chapter" href="Netmcore.html">
<link title="Netmcore_camlbox" rel="Chapter" href="Netmcore_camlbox.html">
<link title="Netmcore_mempool" rel="Chapter" href="Netmcore_mempool.html">
<link title="Netmcore_heap" rel="Chapter" href="Netmcore_heap.html">
<link title="Netmcore_ref" rel="Chapter" href="Netmcore_ref.html">
<link title="Netmcore_array" rel="Chapter" href="Netmcore_array.html">
<link title="Netmcore_sem" rel="Chapter" href="Netmcore_sem.html">
<link title="Netmcore_mutex" rel="Chapter" href="Netmcore_mutex.html">
<link title="Netmcore_condition" rel="Chapter" href="Netmcore_condition.html">
<link title="Netmcore_queue" rel="Chapter" href="Netmcore_queue.html">
<link title="Netmcore_buffer" rel="Chapter" href="Netmcore_buffer.html">
<link title="Netmcore_matrix" rel="Chapter" href="Netmcore_matrix.html">
<link title="Netmcore_hashtbl" rel="Chapter" href="Netmcore_hashtbl.html">
<link title="Netmcore_process" rel="Chapter" href="Netmcore_process.html">
<link title="Netmcore_tut" rel="Chapter" href="Netmcore_tut.html">
<link title="Netmcore_basics" rel="Chapter" href="Netmcore_basics.html">
<link title="Netplex_types" rel="Chapter" href="Netplex_types.html">
<link title="Netplex_mp" rel="Chapter" href="Netplex_mp.html">
<link title="Netplex_mt" rel="Chapter" href="Netplex_mt.html">
<link title="Netplex_log" rel="Chapter" href="Netplex_log.html">
<link title="Netplex_controller" rel="Chapter" href="Netplex_controller.html">
<link title="Netplex_container" rel="Chapter" href="Netplex_container.html">
<link title="Netplex_sockserv" rel="Chapter" href="Netplex_sockserv.html">
<link title="Netplex_workload" rel="Chapter" href="Netplex_workload.html">
<link title="Netplex_main" rel="Chapter" href="Netplex_main.html">
<link title="Netplex_config" rel="Chapter" href="Netplex_config.html">
<link title="Netplex_kit" rel="Chapter" href="Netplex_kit.html">
<link title="Rpc_netplex" rel="Chapter" href="Rpc_netplex.html">
<link title="Netplex_cenv" rel="Chapter" href="Netplex_cenv.html">
<link title="Netplex_semaphore" rel="Chapter" href="Netplex_semaphore.html">
<link title="Netplex_sharedvar" rel="Chapter" href="Netplex_sharedvar.html">
<link title="Netplex_mutex" rel="Chapter" href="Netplex_mutex.html">
<link title="Netplex_encap" rel="Chapter" href="Netplex_encap.html">
<link title="Netplex_mbox" rel="Chapter" href="Netplex_mbox.html">
<link title="Netplex_internal" rel="Chapter" href="Netplex_internal.html">
<link title="Netplex_intro" rel="Chapter" href="Netplex_intro.html">
<link title="Netplex_advanced" rel="Chapter" href="Netplex_advanced.html">
<link title="Netplex_admin" rel="Chapter" href="Netplex_admin.html">
<link title="Netshm" rel="Chapter" href="Netshm.html">
<link title="Netshm_data" rel="Chapter" href="Netshm_data.html">
<link title="Netshm_hashtbl" rel="Chapter" href="Netshm_hashtbl.html">
<link title="Netshm_array" rel="Chapter" href="Netshm_array.html">
<link title="Netshm_intro" rel="Chapter" href="Netshm_intro.html">
<link title="Netstring_pcre" rel="Chapter" href="Netstring_pcre.html">
<link title="Netconversion" rel="Chapter" href="Netconversion.html">
<link title="Netchannels" rel="Chapter" href="Netchannels.html">
<link title="Netstream" rel="Chapter" href="Netstream.html">
<link title="Netmime_string" rel="Chapter" href="Netmime_string.html">
<link title="Netmime" rel="Chapter" href="Netmime.html">
<link title="Netsendmail" rel="Chapter" href="Netsendmail.html">
<link title="Neturl" rel="Chapter" href="Neturl.html">
<link title="Netaddress" rel="Chapter" href="Netaddress.html">
<link title="Netbuffer" rel="Chapter" href="Netbuffer.html">
<link title="Netmime_header" rel="Chapter" href="Netmime_header.html">
<link title="Netmime_channels" rel="Chapter" href="Netmime_channels.html">
<link title="Neturl_ldap" rel="Chapter" href="Neturl_ldap.html">
<link title="Netdate" rel="Chapter" href="Netdate.html">
<link title="Netencoding" rel="Chapter" href="Netencoding.html">
<link title="Netulex" rel="Chapter" href="Netulex.html">
<link title="Netaccel" rel="Chapter" href="Netaccel.html">
<link title="Netaccel_link" rel="Chapter" href="Netaccel_link.html">
<link title="Nethtml" rel="Chapter" href="Nethtml.html">
<link title="Netstring_str" rel="Chapter" href="Netstring_str.html">
<link title="Netmappings" rel="Chapter" href="Netmappings.html">
<link title="Netaux" rel="Chapter" href="Netaux.html">
<link title="Nethttp" rel="Chapter" href="Nethttp.html">
<link title="Netpagebuffer" rel="Chapter" href="Netpagebuffer.html">
<link title="Netfs" rel="Chapter" href="Netfs.html">
<link title="Netglob" rel="Chapter" href="Netglob.html">
<link title="Netauth" rel="Chapter" href="Netauth.html">
<link title="Netsockaddr" rel="Chapter" href="Netsockaddr.html">
<link title="Netnumber" rel="Chapter" href="Netnumber.html">
<link title="Netxdr_mstring" rel="Chapter" href="Netxdr_mstring.html">
<link title="Netxdr" rel="Chapter" href="Netxdr.html">
<link title="Netcompression" rel="Chapter" href="Netcompression.html">
<link title="Netunichar" rel="Chapter" href="Netunichar.html">
<link title="Netasn1" rel="Chapter" href="Netasn1.html">
<link title="Netasn1_encode" rel="Chapter" href="Netasn1_encode.html">
<link title="Netoid" rel="Chapter" href="Netoid.html">
<link title="Netstring_tstring" rel="Chapter" href="Netstring_tstring.html">
<link title="Netdn" rel="Chapter" href="Netdn.html">
<link title="Netx509" rel="Chapter" href="Netx509.html">
<link title="Netascii_armor" rel="Chapter" href="Netascii_armor.html">
<link title="Nettls_support" rel="Chapter" href="Nettls_support.html">
<link title="Netmech_scram" rel="Chapter" href="Netmech_scram.html">
<link title="Netmech_scram_gssapi" rel="Chapter" href="Netmech_scram_gssapi.html">
<link title="Netmech_scram_sasl" rel="Chapter" href="Netmech_scram_sasl.html">
<link title="Netmech_scram_http" rel="Chapter" href="Netmech_scram_http.html">
<link title="Netgssapi_support" rel="Chapter" href="Netgssapi_support.html">
<link title="Netgssapi_auth" rel="Chapter" href="Netgssapi_auth.html">
<link title="Netchannels_crypto" rel="Chapter" href="Netchannels_crypto.html">
<link title="Netx509_pubkey" rel="Chapter" href="Netx509_pubkey.html">
<link title="Netx509_pubkey_crypto" rel="Chapter" href="Netx509_pubkey_crypto.html">
<link title="Netsaslprep" rel="Chapter" href="Netsaslprep.html">
<link title="Netmech_plain_sasl" rel="Chapter" href="Netmech_plain_sasl.html">
<link title="Netmech_crammd5_sasl" rel="Chapter" href="Netmech_crammd5_sasl.html">
<link title="Netmech_digest_sasl" rel="Chapter" href="Netmech_digest_sasl.html">
<link title="Netmech_digest_http" rel="Chapter" href="Netmech_digest_http.html">
<link title="Netmech_krb5_sasl" rel="Chapter" href="Netmech_krb5_sasl.html">
<link title="Netmech_gs2_sasl" rel="Chapter" href="Netmech_gs2_sasl.html">
<link title="Netmech_spnego_http" rel="Chapter" href="Netmech_spnego_http.html">
<link title="Netchannels_tut" rel="Chapter" href="Netchannels_tut.html">
<link title="Netmime_tut" rel="Chapter" href="Netmime_tut.html">
<link title="Netsendmail_tut" rel="Chapter" href="Netsendmail_tut.html">
<link title="Netulex_tut" rel="Chapter" href="Netulex_tut.html">
<link title="Neturl_tut" rel="Chapter" href="Neturl_tut.html">
<link title="Netsys" rel="Chapter" href="Netsys.html">
<link title="Netsys_posix" rel="Chapter" href="Netsys_posix.html">
<link title="Netsys_pollset" rel="Chapter" href="Netsys_pollset.html">
<link title="Netlog" rel="Chapter" href="Netlog.html">
<link title="Netexn" rel="Chapter" href="Netexn.html">
<link title="Netsys_win32" rel="Chapter" href="Netsys_win32.html">
<link title="Netsys_pollset_posix" rel="Chapter" href="Netsys_pollset_posix.html">
<link title="Netsys_pollset_win32" rel="Chapter" href="Netsys_pollset_win32.html">
<link title="Netsys_pollset_generic" rel="Chapter" href="Netsys_pollset_generic.html">
<link title="Netsys_signal" rel="Chapter" href="Netsys_signal.html">
<link title="Netsys_oothr" rel="Chapter" href="Netsys_oothr.html">
<link title="Netsys_xdr" rel="Chapter" href="Netsys_xdr.html">
<link title="Netsys_rng" rel="Chapter" href="Netsys_rng.html">
<link title="Netsys_crypto_types" rel="Chapter" href="Netsys_crypto_types.html">
<link title="Netsys_types" rel="Chapter" href="Netsys_types.html">
<link title="Netsys_mem" rel="Chapter" href="Netsys_mem.html">
<link title="Netsys_tmp" rel="Chapter" href="Netsys_tmp.html">
<link title="Netsys_sem" rel="Chapter" href="Netsys_sem.html">
<link title="Netsys_pmanage" rel="Chapter" href="Netsys_pmanage.html">
<link title="Netsys_crypto" rel="Chapter" href="Netsys_crypto.html">
<link title="Netsys_tls" rel="Chapter" href="Netsys_tls.html">
<link title="Netsys_ciphers" rel="Chapter" href="Netsys_ciphers.html">
<link title="Netsys_digests" rel="Chapter" href="Netsys_digests.html">
<link title="Netsys_crypto_modes" rel="Chapter" href="Netsys_crypto_modes.html">
<link title="Netsys_gssapi" rel="Chapter" href="Netsys_gssapi.html">
<link title="Netsys_sasl_types" rel="Chapter" href="Netsys_sasl_types.html">
<link title="Netsys_sasl" rel="Chapter" href="Netsys_sasl.html">
<link title="Netsys_polypipe" rel="Chapter" href="Netsys_polypipe.html">
<link title="Netsys_polysocket" rel="Chapter" href="Netsys_polysocket.html">
<link title="Netsys_global" rel="Chapter" href="Netsys_global.html">
<link title="Nettls_gnutls_bindings" rel="Chapter" href="Nettls_gnutls_bindings.html">
<link title="Nettls_nettle_bindings" rel="Chapter" href="Nettls_nettle_bindings.html">
<link title="Nettls_gnutls" rel="Chapter" href="Nettls_gnutls.html">
<link title="Netunidata" rel="Chapter" href="Netunidata.html">
<link title="Netgzip" rel="Chapter" href="Netgzip.html">
<link title="Rpc_auth_local" rel="Chapter" href="Rpc_auth_local.html">
<link title="Rpc_xti_client" rel="Chapter" href="Rpc_xti_client.html">
<link title="Rpc" rel="Chapter" href="Rpc.html">
<link title="Rpc_program" rel="Chapter" href="Rpc_program.html">
<link title="Rpc_util" rel="Chapter" href="Rpc_util.html">
<link title="Rpc_portmapper_aux" rel="Chapter" href="Rpc_portmapper_aux.html">
<link title="Rpc_packer" rel="Chapter" href="Rpc_packer.html">
<link title="Rpc_transport" rel="Chapter" href="Rpc_transport.html">
<link title="Rpc_client" rel="Chapter" href="Rpc_client.html">
<link title="Rpc_simple_client" rel="Chapter" href="Rpc_simple_client.html">
<link title="Rpc_portmapper_clnt" rel="Chapter" href="Rpc_portmapper_clnt.html">
<link title="Rpc_portmapper" rel="Chapter" href="Rpc_portmapper.html">
<link title="Rpc_server" rel="Chapter" href="Rpc_server.html">
<link title="Rpc_auth_sys" rel="Chapter" href="Rpc_auth_sys.html">
<link title="Rpc_auth_gssapi" rel="Chapter" href="Rpc_auth_gssapi.html">
<link title="Rpc_proxy" rel="Chapter" href="Rpc_proxy.html">
<link title="Rpc_intro" rel="Chapter" href="Rpc_intro.html">
<link title="Rpc_mapping_ref" rel="Chapter" href="Rpc_mapping_ref.html">
<link title="Rpc_intro_gss" rel="Chapter" href="Rpc_intro_gss.html">
<link title="Shell_sys" rel="Chapter" href="Shell_sys.html">
<link title="Shell" rel="Chapter" href="Shell.html">
<link title="Shell_uq" rel="Chapter" href="Shell_uq.html">
<link title="Shell_fs" rel="Chapter" href="Shell_fs.html">
<link title="Shell_intro" rel="Chapter" href="Shell_intro.html">
<link title="Intro" rel="Chapter" href="Intro.html">
<link title="Platform" rel="Chapter" href="Platform.html">
<link title="Foreword" rel="Chapter" href="Foreword.html">
<link title="Ipv6" rel="Chapter" href="Ipv6.html">
<link title="Regexp" rel="Chapter" href="Regexp.html">
<link title="Tls" rel="Chapter" href="Tls.html">
<link title="Crypto" rel="Chapter" href="Crypto.html">
<link title="Authentication" rel="Chapter" href="Authentication.html">
<link title="Credentials" rel="Chapter" href="Credentials.html">
<link title="Gssapi" rel="Chapter" href="Gssapi.html">
<link title="Ocamlnet4" rel="Chapter" href="Ocamlnet4.html">
<link title="Get" rel="Chapter" href="Get.html"><link title="Classical API" rel="Section" href="#2_ClassicalAPI">
<link title="Classical API" rel="Section" href="#2_ClassicalAPI">
<link title="API with versioned access" rel="Section" href="#2_APIwithversionedaccess">
<link title="API with versioned access" rel="Section" href="#2_APIwithversionedaccess">
<link title="Classical functor" rel="Section" href="#2_Classicalfunctor">
<link title="Functor with versioned access" rel="Section" href="#2_Functorwithversionedaccess">
<link title="Netsys_global" rel="Section" href="#2_Netsysglobal">
<link title="Netsys_global" rel="Section" href="#2_Netsysglobal">
<link title="Examples" rel="Section" href="#2_Examples">
<link title="Examples" rel="Section" href="#2_Examples">
<title>Ocamlnet 4 Reference Manual : Netplex_sharedvar</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Netplex_semaphore.html" title="Netplex_semaphore">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Netplex_mutex.html" title="Netplex_mutex">Next</a>
</div>
<h1>Module <a href="type_Netplex_sharedvar.html">Netplex_sharedvar</a></h1>

<pre><span class="keyword">module</span> Netplex_sharedvar: <code class="code">sig</code> <a href="Netplex_sharedvar.html">..</a> <code class="code">end</code></pre><div class="info module top">
Netplex-wide variables<br>
</div>
<hr width="100%">
<br>
This plugin allows to have Netplex-global variables that can be read
    and written by all components. These variables are useful to communicate
    names and other small pieces of information across the whole Netplex.
    For instance, one component could allocate a shared memory object, and
    put its name into a variable to make it known to other components.
<p>

    This implementation works in both multi-processing and
    multi-threading netplex environments. It is, however, not very
    fast, because the variables live in the controller, and the
    access operations are realized by RPC's. It is good
    enough when these operations are only infrequently called, e.g. in
    the post-start and pre-finish processor callbacks.
<p>

    Furthermore, note that it is unwise to put large values into
    variables when using them in multi-processing contexts. The controller
    process is also the parent process of all <code class="code">fork</code>ed children, and
    when a lot of memory is allocated in the controller, all
    this memory needs to be copied when the <code class="code">fork</code> is done. As workaround,
    put such values into temporary files, and only pass the names of the
    files around via variables.
<p>

    Variables come in two flavors:<ul>
<li>String variables</li>
<li>Encapsulated variables (see <a href="Netplex_encap.html"><code class="code">Netplex_encap</code></a>)</li>
</ul>

    A string variable cannot be accessed as encapsulated variable, and
    vice versa.
<p>

    The latter kind is useful to safely store structured ocaml values in
    Netplex variables.
<p>

    More documentation can also be found here:
    <a href="Netplex_advanced.html#sharedvars"><i>Storing global state</i></a>
<p>

    <b>Thread safety:</b> Full. The functions can be called from any thread.<br>

<pre><span id="EXCEPTIONSharedvar_type_mismatch"><span class="keyword">exception</span> Sharedvar_type_mismatch</span> <span class="keyword">of</span> <code class="type">string</code></pre>
<div class="info ">
The (dynamically typed) variable has the wrong type (string/exn)<br>
</div>

<pre><span id="EXCEPTIONSharedvar_no_permission"><span class="keyword">exception</span> Sharedvar_no_permission</span> <span class="keyword">of</span> <code class="type">string</code></pre>
<div class="info ">
It is not allowed to set the value<br>
</div>

<pre><span id="EXCEPTIONSharedvar_not_found"><span class="keyword">exception</span> Sharedvar_not_found</span> <span class="keyword">of</span> <code class="type">string</code></pre>
<div class="info ">
The variable does not exist. Only used by <code class="code">Make_var_type</code><br>
</div>

<pre><span id="EXCEPTIONSharedvar_null"><span class="keyword">exception</span> Sharedvar_null</span></pre>
<div class="info ">
The initial value of a shared exception variable<br>
</div>

<pre><span id="VALplugin"><span class="keyword">val</span> plugin</span> : <code class="type"><a href="Netplex_types.plugin-c.html">Netplex_types.plugin</a></code></pre><div class="info ">
To enable shared variables, call the controller's <code class="code">add_plugin</code> method
      with this object as argument. This can e.g. be done in the
      <code class="code">post_add_hook</code> of the processor.<br>
</div>
<br>
<h2 id="2_ClassicalAPI">Classical API</h2><br>
<br>
<h2 id="2_ClassicalAPI">Classical API</h2><br>
<br>
Most of the folloing functions can be invoked in both container
    and controller contexts, with the notable exception of
    <code class="code">wait_for_value</code>.<br>

<pre><span id="VALcreate_var"><span class="keyword">val</span> create_var</span> : <code class="type">?own:bool -><br>       ?ro:bool -> ?enc:bool -> ?timeout:float -> ?ssn:string -> string -> bool</code></pre><div class="info ">
Create the variable with the passed name with an empty string
      (or the exception <code class="code">Sharedvar_null</code>) as
      initial value. If the creation is possible (i.e. the variable did
      not exist already), the function returns <code class="code">true</code>, otherwise 
      the already existing variable is left unchanged, and <code class="code">false</code> is
      passed back. By default, the variable can be modified and deleted
      by any other container. Two options allow you to change that:
<p>
<ul>
<li><code class="code">own</code>: If true, the created variable is owned by the calling
        socket service. Only the caller can delete it, and when the 
        last component of the socket service terminates, the variable is
        automatically deleted. The deletion happens after the
        <code class="code">post_finish_hook</code> is executed, so the variable is still accessible
        from this hook. Note that the controller has unlimited access anyway.</li>
<li><code class="code">ro</code>: if true, only the owner can set the value</li>
<li><code class="code">enc</code>: if true, the variable stores encapsulated values, otherwise
        strings
        (defaults to false)</li>
<li><code class="code">timeout</code>: if passed, the variable will be automatically deleted
        after this number of seconds. The timeout starts anew with every
        read or write of the variable.</li>
<li><code class="code">ssn</code>: If called from the controller and <code class="code">own</code>, this must be set to the
        socket service name of the owner</li>
</ul>

      Variable names are global to the whole netplex system. By convention,
      these names are formed like <code class="code">"service_name.local_name"</code>, i.e. they
      are prefixed by the socket service to which they refer.<br>
</div>

<pre><span id="VALdelete_var"><span class="keyword">val</span> delete_var</span> : <code class="type">string -> bool</code></pre><div class="info ">
<code class="code">delete_var name</code>: Deletes the variable <code class="code">name</code>. Returns <code class="code">true</code> if
      the deletion could be carried out, and <code class="code">false</code> when the variable
      does not exist, or the container does not have permission to delete
      the variable.<br>
</div>

<pre><span id="VALset_value"><span class="keyword">val</span> set_value</span> : <code class="type">string -> string -> bool</code></pre><div class="info ">
<code class="code">set_value name value</code>: Sets the variable <code class="code">name</code> to <code class="code">value</code>. This
      is only possible when the variable exists, and is writable.
      Returns <code class="code">true</code> if the function is successful, and <code class="code">false</code> when
      the variable does not exist.
<p>

      Raises <code class="code">Sharedvar_no_permission</code> if the variable cannot be modified.
<p>

      Raises <code class="code">Sharedvar_type_mismatch</code> if the variable is not a string
      variable.<br>
</div>

<pre><span id="VALset_enc_value"><span class="keyword">val</span> set_enc_value</span> : <code class="type">string -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a> -> bool</code></pre><div class="info ">
<code class="code">set_enc_value name value</code>: Sets the variable <code class="code">name</code> to <code class="code">value</code>.
      Return value as for <code class="code">set_value</code>.
<p>

      Raises <code class="code">Sharedvar_no_permission</code> if the variable cannot be modified.
<p>

      Raises <code class="code">Sharedvar_type_mismatch</code> if the variable is not encapsulated<br>
</div>

<pre><span id="VALget_value"><span class="keyword">val</span> get_value</span> : <code class="type">string -> string option</code></pre><div class="info ">
<code class="code">get_value name</code>: Gets the value of the variable <code class="code">name</code>. If the
      variable does not exist, <code class="code">None</code> is returned.
<p>

      Raises <code class="code">Sharedvar_type_mismatch</code> if the variable is not a string
      variable.<br>
</div>

<pre><span id="VALget_enc_value"><span class="keyword">val</span> get_enc_value</span> : <code class="type">string -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a> option</code></pre><div class="info ">
<code class="code">get_enc_value name</code>: Gets the value of the variable <code class="code">name</code>. If the
      variable does not exist, <code class="code">None</code> is returned.
<p>

      Raises <code class="code">Sharedvar_type_mismatch</code> if the variable is not encapsulated<br>
</div>

<pre><span id="VALwait_for_value"><span class="keyword">val</span> wait_for_value</span> : <code class="type">string -> string option</code></pre><div class="info ">
<code class="code">wait_for_value name</code>: If the variable exists and <code class="code">set_value</code> has
      already been called at least once, the current value is returned. 
      If the variable exists, but <code class="code">set_value</code> has not yet been called at all,
      the function waits until <code class="code">set_value</code> is called, and returns the value
      set then. If the variable does not exist, the function immediately
      returns <code class="code">None</code>.
<p>

      An ongoing wait is interrupted when the variable is deleted. In this
      case <code class="code">None</code> is returned.
<p>

      <b>This function can only be invoked from container context!</b><br>
</div>

<pre><span id="VALwait_for_enc_value"><span class="keyword">val</span> wait_for_enc_value</span> : <code class="type">string -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a> option</code></pre><div class="info ">
Same for encapsulated variables<br>
</div>

<pre><span id="VALget_lazily"><span class="keyword">val</span> get_lazily</span> : <code class="type">string -> (unit -> string) -> string option</code></pre><div class="info ">
<code class="code">get_lazily name f</code>: Uses the variable <code class="code">name</code> to ensure that <code class="code">f</code>
      is only invoked when <code class="code">get_lazily</code> is called for the first time,
      and that the value stored in the variable is returned the
      next times. This works from whatever component <code class="code">get_lazily</code>
      is called.
<p>

      If <code class="code">f()</code> raises an exception, the exception is suppressed, and
      <code class="code">None</code> is returned as result of <code class="code">get_lazily</code>. Exceptions are not
      stored in the variable, so the next time <code class="code">get_lazily</code> is called
      it is again tried to compute the value of <code class="code">f()</code>. If you want to
      catch the exception this must done in the body of <code class="code">f</code>.
<p>

      No provisions are taken to delete the variable. If <code class="code">delete_var</code>
      is called by user code (which is allowed at any time), and
      <code class="code">get_lazily</code> is called again, the lazy value will again be computed.
<p>

      <b>This function can only be invoked from container context!</b><br>
</div>

<pre><span id="VALget_enc_lazily"><span class="keyword">val</span> get_enc_lazily</span> : <code class="type">string -> (unit -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a>) -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a> option</code></pre><div class="info ">
Same for encapsulated values<br>
</div>

<pre><span id="VALdump"><span class="keyword">val</span> dump</span> : <code class="type">string -> <a href="Netlog.html#TYPElevel">Netlog.level</a> -> unit</code></pre><div class="info ">
Dumps the access counter of this variable to <a href="Netlog.html"><code class="code">Netlog</code></a>. The
      string argument "*" dumps all variables.<br>
</div>
<br>
<h2 id="2_APIwithversionedaccess">API with versioned access</h2><br>
<br>
<h2 id="2_APIwithversionedaccess">API with versioned access</h2><br>
<br>
The API with versioned values can very quickly check whether newer
    values are available (the check consists just of a memory read). If a newer
    version is avaiable, the value still needs to be retrieved with an
    RPC call, though.
<p>

    The central function is <code class="code">vv_update</code>. See also the limitations mentioned
    there.<br>

<pre><span id="TYPEversioned_value"><span class="keyword">type</span> <code class="type">'a</code> versioned_value</span> </pre>
<div class="info ">
Cache for the current value<br>
</div>


<pre><span id="VALvv_access"><span class="keyword">val</span> vv_access</span> : <code class="type">string -> string <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a></code></pre><div class="info ">
Get the current value of this variable. This succeeds even when the
      variable does not exist.<br>
</div>

<pre><span id="VALvv_access_enc"><span class="keyword">val</span> vv_access_enc</span> : <code class="type">string -> <a href="Netplex_types.html#TYPEencap">Netplex_types.encap</a> <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a></code></pre><div class="info ">
Same for encapsulated variables<br>
</div>

<pre><span id="VALvv_get"><span class="keyword">val</span> vv_get</span> : <code class="type">'a <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a> -> 'a option</code></pre><div class="info ">
Extract the current value, or <code class="code">None</code> if the variable cannot be found.<br>
</div>

<pre><span id="VALvv_version"><span class="keyword">val</span> vv_version</span> : <code class="type">'a <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a> -> int64</code></pre><div class="info ">
Get the current version number.  The version number is increased by
      every "set" operation. Raised <code class="code">Not_found</code> if the variable cannot be
      found.<br>
</div>

<pre><span id="VALvv_update"><span class="keyword">val</span> vv_update</span> : <code class="type">'a <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a> -> bool</code></pre><div class="info ">
Check whether there is a new version of the value, and update the
      cache. Return whether the update occurred.
<p>

      Note that there is a limitation on the number of variables that can
      use <code class="code">vv_update</code>. For every <code class="code">versioned_value</code> a slot in a shared memory
      segment is allocated. However, there is only a limited number of such
      slots (currently 1023). If more slots are needed, the performance will
      be degraded.<br>
</div>

<pre><span id="VALvv_set"><span class="keyword">val</span> vv_set</span> : <code class="type">'a <a href="Netplex_sharedvar.html#TYPEversioned_value">versioned_value</a> -> 'a -> bool</code></pre><div class="info ">
Set the current value. Return whether successful<br>
</div>
<br>
<h2 id="2_Classicalfunctor">Classical functor</h2><br>

<pre><span class="keyword">module</span> <a href="Netplex_sharedvar.Make_var_type.html">Make_var_type</a>: <div class="sig_block"><code class="code">functor (</code><code class="code">T</code><code class="code"> : </code><code class="type"><a href="Netplex_cenv.TYPE.html">Netplex_cenv.TYPE</a></code><code class="code">) -&gt; </code><code class="type"><a href="Netplex_cenv.VAR_TYPE.html">Netplex_cenv.VAR_TYPE</a></code><code class="type">  with type t = T.t</code></div></pre><div class="info">
Creates a module with <code class="code">get</code> and <code class="code">set</code> functions to access variables
      of type <code class="code">T.t</code>.
</div>
<br>
<h2 id="2_Functorwithversionedaccess">Functor with versioned access</h2><br>

<pre><span class="keyword">module type</span> <a href="Netplex_sharedvar.VV_TYPE.html">VV_TYPE</a> = <code class="code">sig</code> <a href="Netplex_sharedvar.VV_TYPE.html">..</a> <code class="code">end</code></pre>
<pre><span class="keyword">module</span> <a href="Netplex_sharedvar.Make_vv.html">Make_vv</a>: <div class="sig_block"><code class="code">functor (</code><code class="code">T</code><code class="code"> : </code><code class="type"><a href="Netplex_cenv.TYPE.html">Netplex_cenv.TYPE</a></code><code class="code">) -&gt; </code><code class="type"><a href="Netplex_sharedvar.VV_TYPE.html">VV_TYPE</a></code><code class="type">  with type t = T.t</code></div></pre><br>
<h2 id="2_Netsysglobal">Netsys_global</h2><br>
<br>
<h2 id="2_Netsysglobal">Netsys_global</h2><br>
<br>
This is a propagator for <a href="Netsys_global.html"><code class="code">Netsys_global</code></a>. It is automatically activated
    when the Netplex controller is started.<br>

<pre><span id="VALglobal_propagator"><span class="keyword">val</span> global_propagator</span> : <code class="type">unit -> <a href="Netsys_global.propagator-c.html">Netsys_global.propagator</a></code></pre><div class="info ">
Create a new propagator, and initialize <a href="Netplex_sharedvar.html"><code class="code">Netplex_sharedvar</code></a>
    with the current variables from <a href="Netsys_global.html"><code class="code">Netsys_global</code></a>. Note that a
    global variable with name <code class="code">n</code> appears in Netplex as variable
    <code class="code">"global." ^ n</code>.
<p>

    The version numbers appearing in both modules are unrelated.
<p>

    This function must be called from controller context.<br>
</div>

<pre><span id="VALpropagate_back"><span class="keyword">val</span> propagate_back</span> : <code class="type"><a href="Netplex_types.controller-c.html">Netplex_types.controller</a> -> unit</code></pre><div class="info ">
Copy the global variables from <a href="Netplex_sharedvar.html"><code class="code">Netplex_sharedvar</code></a> (with prefix
      "global.") back to <a href="Netsys_global.html"><code class="code">Netsys_global</code></a><br>
</div>
<br>
<h2 id="2_Examples">Examples</h2><br>
<br>
<h2 id="2_Examples">Examples</h2><br>
<br>
Example code:
<p>

    Here, one randomly chosen container computes <code class="code">precious_value</code>, and
    makes it available to all others, so the other container can simply
    grab the value. This is similar to what <code class="code">get_lazily</code> does internally:
<p>

    <pre class="codepre"><code class="code">      let get_precious_value() =
        let container = Netplex_cenv.self_cont() in
        let var_name = "my_service.precious" in
        if Netplex_sharedvar.create_var var_name then (
          let precious_value = 
            try ...    (* some costly computation *)
            with exn -&gt;
              ignore(Netplex_sharedvar.delete_var var_name);
              raise exn in
          let b = Netplex_sharedvar.set_value var_name precious_value in
          assert b;
          precious_value
        )
        else (
          match Netplex_sharedvar.wait_for_value var_name with
           | Some v -&gt; v
           | None -&gt; failwith "get_precious_value"
                       (* or do plan B, e.g. compute the value *)
        )
    </code></pre>
<p>

    We don't do anything here for deleting the value when it is no longer
    needed. Finding a criterion for that is very application-specific. 
    If the variable can be thought as being another service endpoint
    of a socket service, it is a good idea to acquire the ownership
    (by passing <code class="code">~own:true</code> to <code class="code">create_var</code>), so the variable is automatically
    deleted when the socket service stops.
<p>

    Of course, the plugin must be enabled, e.g. by overriding the 
    <code class="code">post_add_hook</code> processor hook:
<p>

   <pre class="codepre"><code class="code"> 
    method post_add_hook sockserv ctrl =
      ctrl # add_plugin Netplex_sharedvar.plugin
   </code></pre><br>
</body></html>